<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rep Down</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation;
            background-color: #000; /* Force black background */
        }
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
        .text-glow {
            text-shadow: 0 0 8px currentColor;
        }
        .container-glow {
            box-shadow: 0 0 20px rgba(255, 191, 0, 0.4), inset 0 0 15px rgba(255, 191, 0, 0.2);
            border-color: rgba(255, 191, 0, 0.7);
        }
        .btn-glow {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 0 5px rgba(255, 191, 0, 0.7), 0 0 10px rgba(255, 191, 0, 0.5);
        }
        .btn-glow:hover:not(:disabled) {
            box-shadow: 0 0 10px rgba(255, 191, 0, 0.9), 0 0 20px rgba(255, 191, 0, 0.7);
        }
        .exercise-item[data-completed="true"] .exercise-name {
            text-decoration: line-through;
            color: #6b7280; /* gray-500 */
        }
    </style>
</head>
<body class="bg-black text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div id="app-container" class="w-full max-w-md mx-auto p-4 sm:p-6 text-center bg-gray-900/80 backdrop-blur-sm rounded-2xl border-2 container-glow">

        <!-- Setup Screen -->
        <div id="setup-screen">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-amber-400 mb-2 text-glow">Rep Down</h1>
            <p id="retry-info" class="text-cyan-400 text-lg my-2 hidden"></p>
            <p id="current-date" class="text-gray-400 text-lg mb-2"></p>
            <p id="challenge-day-info" class="text-amber-400 font-bold text-2xl mb-4 text-glow"></p>
            
            <div class="bg-black/50 p-6 rounded-xl">
                 <p id="recommended-reps" class="text-gray-300 text-lg mb-6"></p>
                <div class="mb-6">
                    <label class="block text-lg font-semibold mb-3 text-gray-300">Select Your Exercises</label>
                    <div id="exercise-selection" class="space-y-3 text-left w-fit mx-auto">
                        <div class="flex items-center">
                            <input id="pushups-check" type="checkbox" checked value="Pushups" class="w-5 h-5 text-amber-400 bg-gray-700 border-gray-600 rounded focus:ring-amber-500 focus:ring-2">
                            <label for="pushups-check" class="ml-3 text-lg font-medium text-gray-300">Pushups</label>
                        </div>
                        <div class="flex items-center">
                            <input id="squats-check" type="checkbox" checked value="Squats" class="w-5 h-5 text-amber-400 bg-gray-700 border-gray-600 rounded focus:ring-amber-500 focus:ring-2">
                            <label for="squats-check" class="ml-3 text-lg font-medium text-gray-300">Squats</label>
                        </div>
                        <div class="flex items-center">
                            <input id="vups-check" type="checkbox" checked value="V-ups" class="w-5 h-5 text-amber-400 bg-gray-700 border-gray-600 rounded focus:ring-amber-500 focus:ring-2">
                            <label for="vups-check" class="ml-3 text-lg font-medium text-gray-300">V-ups</label>
                        </div>
                    </div>
                    <p id="exercise-error" class="text-red-500 text-sm mt-2 hidden">Please select at least one exercise.</p>
                </div>
                <div class="mb-4">
                    <label for="reps-input" class="block text-lg font-semibold mb-3 text-gray-300">Starting Reps</label>
                    <input type="number" id="reps-input" value="10" min="1" max="100" class="w-full bg-gray-800 text-white text-3xl text-center font-bold p-4 rounded-xl border-2 border-gray-600 focus:border-amber-400 focus:ring-amber-400 focus:ring-1 outline-none">
                    <p id="reps-error" class="text-red-500 text-sm mt-2 hidden">Please enter a number between 1 and 100.</p>
                </div>
                <button id="start-btn" class="w-full bg-transparent hover:bg-amber-400 text-amber-400 hover:text-black font-bold text-xl py-4 px-6 rounded-xl border-2 border-amber-400 btn-glow">
                    Start Workout
                </button>
            </div>
        </div>

        <!-- Workout Screen -->
        <div id="workout-screen" class="hidden">
            <div id="total-timer-container" class="mb-4">
                <p class="text-gray-400 text-lg font-semibold">Time Remaining for this Round</p>
                <p id="total-timer" class="text-5xl font-bold text-gray-200">10:00</p>
            </div>
            <div id="rep-display" class="mb-4">
                <p class="text-gray-400 text-2xl font-semibold">Current Round</p>
                <p id="current-reps" class="text-8xl font-extrabold text-amber-400 text-glow">10</p>
                <p class="text-gray-400 text-2xl font-semibold">Reps per Exercise</p>
            </div>

            <div id="exercise-list" class="my-6 bg-black/50 p-4 sm:p-6 rounded-xl">
                 <h3 class="text-2xl font-bold text-amber-400 mb-4 text-glow">Complete Your Reps:</h3>
                 <div id="dynamic-exercise-list" class="space-y-4">
                    <!-- Dynamic content will be injected here -->
                 </div>
            </div>

            <button id="done-btn" class="w-full bg-transparent hover:bg-amber-400 text-amber-400 hover:text-black font-bold text-xl py-5 px-6 rounded-xl border-2 border-amber-400 btn-glow">
                Start Next Round
            </button>
            <button id="end-btn" class="w-full mt-4 bg-transparent hover:bg-red-600 text-red-500 hover:text-white font-semibold text-md py-2 px-6 rounded-xl border-2 border-red-500">
                End Workout
            </button>
        </div>

        <!-- Completion Screen -->
        <div id="complete-screen" class="hidden">
            <h1 id="complete-title" class="text-5xl font-extrabold text-amber-400 mb-4 text-glow">Well Done!</h1>
            <p class="text-gray-400 text-xl mb-6">You crushed the challenge. Time to recover.</p>
            <p id="total-reps-info" class="text-amber-400 text-2xl font-bold mb-2 text-glow"></p>
            <p id="total-missed-reps-info" class="text-red-500 text-lg font-bold mb-2 text-glow hidden"></p>
            <p id="beast-mode-info" class="text-cyan-400 text-2xl font-bold mb-4 text-glow hidden"></p>
             <svg id="complete-icon" xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 text-amber-400 mx-auto mb-8" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
            </svg>
            <div id="round-summary-container" class="my-6 text-left max-h-60 overflow-y-auto bg-black/50 p-4 rounded-xl">
                <h3 class="text-xl font-bold text-amber-400 mb-3 text-center text-glow">Round Summary</h3>
                <div id="round-summary-list"></div>
            </div>
            <button id="restart-btn" class="w-full bg-transparent hover:bg-amber-400 text-amber-400 hover:text-black font-bold text-xl py-4 px-6 rounded-xl border-2 border-amber-400 btn-glow">
                New Workout
            </button>
        </div>

    </div>

    <script>
        // DOM Elements
        const setupScreen = document.getElementById('setup-screen');
        const workoutScreen = document.getElementById('workout-screen');
        const completeScreen = document.getElementById('complete-screen');
        const appContainer = document.getElementById('app-container');

        const repsInput = document.getElementById('reps-input');
        const startBtn = document.getElementById('start-btn');
        const doneBtn = document.getElementById('done-btn');
        const restartBtn = document.getElementById('restart-btn');
        const endBtn = document.getElementById('end-btn');
        
        const repsError = document.getElementById('reps-error');
        const exerciseError = document.getElementById('exercise-error');
        const exerciseCheckboxes = document.querySelectorAll('#exercise-selection input[type="checkbox"]');
        const dynamicExerciseList = document.getElementById('dynamic-exercise-list');

        const currentRepsDisplay = document.getElementById('current-reps');
        const totalTimerDisplay = document.getElementById('total-timer');
        const challengeDayInfo = document.getElementById('challenge-day-info');
        const currentDateDisplay = document.getElementById('current-date');
        const recommendedRepsDisplay = document.getElementById('recommended-reps');
        const retryInfoDisplay = document.getElementById('retry-info');
        const roundSummaryList = document.getElementById('round-summary-list');
        
        // App State
        let startingReps = 10;
        let currentReps = 10;
        let totalTimerInterval;
        let selectedExercises = [];
        let exerciseStates = {}; // e.g., { Pushups: 10, Squats: 9 } tracks reps to be done
        let totalRepsCompleted = 0;
        let totalRepsMissed = 0;
        let recommendedReps = 0;
        let totalRecommendedReps = 0;
        let previousAttemptCompleted = 0;
        let previousAttemptMissed = 0;
        let roundStartTime;
        let roundTimes = [];

        // Create Retry Button
        const retryBtn = document.createElement('button');
        retryBtn.id = 'retry-btn';
        retryBtn.className = 'w-full mt-4 bg-transparent hover:bg-cyan-500 text-cyan-400 hover:text-black font-bold text-xl py-4 px-6 rounded-xl border-2 border-cyan-400 btn-glow hidden';
        retryBtn.textContent = 'Retry Workout';
        completeScreen.appendChild(retryBtn);
        
        // Event Listeners
        startBtn.addEventListener('click', startWorkout);
        doneBtn.addEventListener('click', completeRound);
        endBtn.addEventListener('click', endWorkout);
        restartBtn.addEventListener('click', () => {
            previousAttemptCompleted = 0;
            previousAttemptMissed = 0;
            roundTimes = [];
            resetApp();
        });
        retryBtn.addEventListener('click', retryWorkout);

        repsInput.addEventListener('change', () => {
             if(parseInt(repsInput.value) < 1) repsInput.value = 1;
             if(parseInt(repsInput.value) > 100) repsInput.value = 100;
        });
        window.addEventListener('DOMContentLoaded', updateChallengeInfo);

        // --- Helper Functions ---
        function sumOfN(n) {
            if (n <= 0) return 0;
            return n * (n + 1) / 2;
        }

        function formatRoundTime(seconds) {
            if (seconds < 60) return `${Math.floor(seconds)}s`;
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}m ${remainingSeconds}s`;
        }


        // --- Core Functions ---

        function updateChallengeInfo() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
            currentDateDisplay.textContent = `Today is ${today.toLocaleDateString(undefined, dateOptions)}.`;

            const currentYear = today.getFullYear();
            const startDate = new Date(currentYear, 8, 10); // Month is 0-indexed, so 8 is September
            startDate.setHours(0, 0, 0, 0);

            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + 19);

            let defaultReps = 10;

            if (today < startDate) {
                challengeDayInfo.textContent = `Challenge starts on 09/10.`;
            } else if (today > endDate) {
                challengeDayInfo.textContent = `The 20-Day Challenge has ended.`;
            } else {
                const timeDiff = today.getTime() - startDate.getTime();
                const dayNumber = Math.floor(timeDiff / (1000 * 3600 * 24)) + 1;
                defaultReps = 10 + (dayNumber - 1);
                challengeDayInfo.textContent = `Day ${dayNumber} of 20`;
            }

            recommendedReps = defaultReps;
            repsInput.value = defaultReps;
            recommendedRepsDisplay.textContent = `Recommended start for today: ${recommendedReps} reps.`;
        }

        function validateInputs() {
            let isValid = true;
            
            const reps = parseInt(repsInput.value);
            if (isNaN(reps) || reps < 1 || reps > 100) {
                repsError.classList.remove('hidden');
                isValid = false;
            } else {
                repsError.classList.add('hidden');
            }

            selectedExercises = Array.from(exerciseCheckboxes)
                                   .filter(cb => cb.checked)
                                   .map(cb => cb.value);
            if (selectedExercises.length === 0) {
                exerciseError.classList.remove('hidden');
                isValid = false;
            } else {
                exerciseError.classList.add('hidden');
            }

            return isValid;
        }

        function startWorkout() {
            if (!validateInputs()) return;

            startingReps = parseInt(repsInput.value);
            currentReps = startingReps;
            totalRepsCompleted = 0;
            totalRepsMissed = 0;
            roundTimes = [];
            
            totalRecommendedReps = sumOfN(recommendedReps) * selectedExercises.length;
            
            exerciseStates = {};
            selectedExercises.forEach(name => {
                exerciseStates[name] = startingReps;
            });
            
            updateRepDisplay();
            buildExerciseTrackers();
            startTotalTimer();
            updateDoneButtonText();

            setupScreen.classList.add('hidden');
            workoutScreen.classList.remove('hidden');
            completeScreen.classList.add('hidden');
        }

        function buildExerciseTrackers() {
            dynamicExerciseList.innerHTML = '';
            selectedExercises.forEach(exerciseName => {
                const exerciseReps = exerciseStates[exerciseName];
                const isOnTarget = exerciseReps === currentReps;
                const repsBehind = exerciseReps - currentReps;

                const item = document.createElement('div');
                item.className = 'exercise-item text-left bg-gray-800 p-3 rounded-lg';
                item.dataset.name = exerciseName;
                item.dataset.completed = 'false';

                let statusHTML;
                if (isOnTarget) {
                    statusHTML = `<span class="text-green-400 font-semibold">On Target</span>`;
                } else {
                    statusHTML = `<span class="text-yellow-400 font-semibold">You're on ${exerciseReps}, catch up!</span>`;
                }

                let buttonClasses = '';
                if (isOnTarget) {
                    buttonClasses = 'bg-amber-400 hover:bg-amber-300 text-black';
                } else if (repsBehind > 0 && repsBehind <= 3) {
                    buttonClasses = 'bg-amber-600 hover:bg-amber-500 text-black';
                } else if (repsBehind > 3) {
                    buttonClasses = 'bg-red-600 hover:bg-red-500 text-white';
                }


                item.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <span class="exercise-name text-lg font-medium text-gray-300 block">${exerciseName}</span>
                            <span class="exercise-status text-sm">${statusHTML}</span>
                        </div>
                        <button class="complete-exercise-btn ${buttonClasses} font-bold py-2 px-4 rounded-md transition-colors">
                            Done
                        </button>
                    </div>
                `;

                dynamicExerciseList.appendChild(item);
                
                const doneButton = item.querySelector('.complete-exercise-btn');
                doneButton.onclick = () => markExerciseComplete(item);
            });
        }
        
        function markExerciseComplete(item) {
            const name = item.dataset.name;
            const exerciseReps = exerciseStates[name];

            if (exerciseReps > currentReps) {
                exerciseStates[name]--; 
                totalRepsCompleted++;   
                buildExerciseTrackers(); 
            } else if (exerciseReps === currentReps) {
                item.dataset.completed = 'true';
                const button = item.querySelector('.complete-exercise-btn');
                button.disabled = true;
                button.textContent = '✔';
                button.classList.remove(
                    'bg-amber-400', 'hover:bg-amber-300', 'text-black',
                    'bg-amber-600', 'hover:bg-amber-500',
                    'bg-red-600', 'hover:bg-red-500', 'text-white'
                );
                button.classList.add('bg-green-600', 'text-white');
            }
        }

        function completeRound() {
            const roundEndTime = Date.now();
            const timeTaken = (roundEndTime - roundStartTime) / 1000;
            const exerciseItems = dynamicExerciseList.querySelectorAll('.exercise-item');
            const allDone = Array.from(exerciseItems).every(item => item.dataset.completed === 'true');
            
            roundTimes.push({
                roundNumber: currentReps,
                timeTaken: timeTaken,
                status: allDone ? 'Completed' : 'Started Early'
            });

            exerciseItems.forEach(item => {
                const name = item.dataset.name;
                const isCompletedThisRound = item.dataset.completed === 'true';
                const repsForThisExercise = exerciseStates[name];

                if (isCompletedThisRound) {
                    totalRepsCompleted += repsForThisExercise;
                    exerciseStates[name] = currentReps - 1;
                } else {
                    totalRepsMissed += repsForThisExercise;
                }
            });
            
            currentReps--;
            
            if (currentReps <= 0) {
                finishWorkout();
                return;
            }
            
            updateRepDisplay();
            buildExerciseTrackers();
            startTotalTimer();
            updateDoneButtonText();
        }
        
        function endWorkout() {
            clearInterval(totalTimerInterval);
            const roundEndTime = Date.now();
            const timeTaken = (roundEndTime - roundStartTime) / 1000;
             roundTimes.push({
                roundNumber: currentReps,
                timeTaken: timeTaken,
                status: 'Ended Early'
            });

            const exerciseItems = dynamicExerciseList.querySelectorAll('.exercise-item');
            exerciseItems.forEach(item => {
                const name = item.dataset.name;
                const isCompletedThisRound = item.dataset.completed === 'true';
                if (!isCompletedThisRound) {
                    totalRepsMissed += exerciseStates[name];
                } else {
                    totalRepsCompleted += exerciseStates[name];
                }
            });

            if (currentReps > 1) {
                const repsInFutureRounds = sumOfN(currentReps - 1);
                totalRepsMissed += repsInFutureRounds * selectedExercises.length;
            }

            showIncompleteScreen();
        }

        function displayRoundSummary() {
            roundSummaryList.innerHTML = '';
            if (roundTimes.length === 0) return;

            roundTimes.forEach(round => {
                const statusColor = round.status === 'Completed' ? 'text-green-400' : (round.status === 'Started Early' ? 'text-yellow-400' : 'text-red-500');
                const summaryItem = document.createElement('div');
                summaryItem.className = 'flex justify-between items-center text-gray-300 py-1 border-b border-gray-700/50';
                summaryItem.innerHTML = `
                    <span>Round <span class="font-bold text-amber-400">${round.roundNumber}</span></span>
                    <span class="font-semibold">${formatRoundTime(round.timeTaken)}</span>
                    <span class="font-bold ${statusColor}">${round.status}</span>
                `;
                roundSummaryList.appendChild(summaryItem);
            });
        }

        function showIncompleteScreen() {
            document.title = 'Rep Down';
            const finalCompleted = totalRepsCompleted + previousAttemptCompleted;
            const finalMissed = totalRepsMissed + previousAttemptMissed;
            
            document.getElementById('complete-title').textContent = "Workout Incomplete";
            document.getElementById('total-reps-info').textContent = `Total Reps Completed: ${finalCompleted}`;
            
            const totalMissedRepsInfo = document.getElementById('total-missed-reps-info');
             if (finalMissed > 0) {
                totalMissedRepsInfo.textContent = `Total Reps Missed: ${finalMissed}`;
                totalMissedRepsInfo.classList.remove('hidden');
            } else {
                totalMissedRepsInfo.classList.add('hidden');
            }

            document.getElementById('beast-mode-info').classList.add('hidden');
            restartBtn.classList.add('hidden');
            retryBtn.classList.remove('hidden');
            document.getElementById('complete-icon').classList.add('text-red-500');
            document.getElementById('complete-icon').classList.remove('text-amber-400');
            
            displayRoundSummary();

            workoutScreen.classList.add('hidden');
            completeScreen.classList.remove('hidden');
        }
        
        function retryWorkout() {
            previousAttemptCompleted += totalRepsCompleted;
            previousAttemptMissed += totalRepsMissed;
            resetApp();
        }

        function finishWorkout() {
            clearInterval(totalTimerInterval);
            document.title = 'Rep Down';
            
            const finalCompleted = totalRepsCompleted + previousAttemptCompleted;
            const finalMissed = totalRepsMissed + previousAttemptMissed;

            document.getElementById('complete-title').textContent = "Well Done!";
            document.getElementById('total-reps-info').textContent = `Total Reps Completed: ${finalCompleted}`;

            const totalMissedRepsInfo = document.getElementById('total-missed-reps-info');
            if (finalMissed > 0) {
                totalMissedRepsInfo.textContent = `Total Reps Missed: ${finalMissed}`;
                totalMissedRepsInfo.classList.remove('hidden');
            } else {
                totalMissedRepsInfo.classList.add('hidden');
            }

            const beastModeInfo = document.getElementById('beast-mode-info');
            const beastModeReps = finalCompleted - totalRecommendedReps;
            if (beastModeReps > 0) {
                beastModeInfo.textContent = `Beast Mode: ${beastModeReps} extra reps!`;
                beastModeInfo.classList.remove('hidden');
            } else {
                beastModeInfo.classList.add('hidden');
            }

            restartBtn.classList.remove('hidden');
            retryBtn.classList.add('hidden');
            document.getElementById('complete-icon').classList.remove('text-red-500');
            document.getElementById('complete-icon').classList.add('text-amber-400');

            displayRoundSummary();

            workoutScreen.classList.add('hidden');
            completeScreen.classList.remove('hidden');
        }
        
        function resetApp() {
            clearInterval(totalTimerInterval);
            document.title = 'Rep Down';
            document.getElementById('total-timer-container').classList.remove('text-red-500');
            
            if (previousAttemptCompleted > 0) {
                retryInfoDisplay.textContent = `${previousAttemptCompleted} reps from your last attempt will be added.`;
                retryInfoDisplay.classList.remove('hidden');
            } else {
                retryInfoDisplay.classList.add('hidden');
            }

            updateChallengeInfo();
            completeScreen.classList.add('hidden');
            workoutScreen.classList.add('hidden');
            setupScreen.classList.remove('hidden');
            repsError.classList.add('hidden');
            exerciseError.classList.add('hidden');
            doneBtn.textContent = 'Start Next Round';
        }

        function updateRepDisplay() {
            currentRepsDisplay.textContent = currentReps;
        }

        function updateDoneButtonText() {
            if (currentReps === 1) {
                doneBtn.textContent = "I'm Done!";
            } else {
                doneBtn.textContent = "Start Next Round";
            }
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            const formattedSeconds = remainingSeconds < 10 ? '0' + remainingSeconds : remainingSeconds;
            return `${minutes}:${formattedSeconds}`;
        }

        function startTotalTimer() {
            clearInterval(totalTimerInterval);
            roundStartTime = Date.now();

            let timeLeft = 600; // 10 minutes
            totalTimerDisplay.textContent = formatTime(timeLeft);
            document.title = `${formatTime(timeLeft)} - Rep Down`;
            const container = document.getElementById('total-timer-container');
            container.querySelector('p:first-child').classList.remove('text-red-500');
            totalTimerDisplay.classList.remove('text-red-500');
            totalTimerInterval = setInterval(() => {
                timeLeft--;
                const formattedTime = formatTime(timeLeft);
                totalTimerDisplay.textContent = formattedTime;
                document.title = `${formattedTime} - Rep Down`;

                if (timeLeft <= 0) {
                    clearInterval(totalTimerInterval);
                    totalTimerDisplay.textContent = "Time's Up!";
                    document.title = "Time's Up! - Rep Down";
                    container.querySelector('p:first-child').classList.add('text-red-500');
                    totalTimerDisplay.classList.add('text-red-500');
                }
            }, 1000);
        }

    </script>
</body>
</html>

